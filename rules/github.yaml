# Rules for matching GitHub secrets
---
.github_user_analyzer: &github_user_analyzer
  meta:
    kind: http
    report: true

  action:
    url: 'https://api.github.com/user'
    method: post
    headers:
      accept: 'application/vnd.github.v3+json'
      authorization: 'Bearer {{ target }}'

  condition:
    - statuses: [200]
      body_syntax: json

rules:
  - id: S3IGSE57RML77YEIXF5X
    meta:
      kind: github_personal_access_token
      name: 'GitHub Personal Access Token'
      confidence: high
      report: true
      tags: ['secret', 'credential']
      description: |-
        Personal access tokens are an alternative to using passwords for
        authentication to GitHub when using the GitHub API or the command line.

        Personal access tokens are intended to access GitHub resources on
        behalf of yourself. To access resources on behalf of an organization,
        or for long-lived integrations, you should use a GitHub App. For more
        information, see About creating GitHub Apps.

        A token has the same capabilities to access resources and perform
        actions on those resources that the owner of the token has, and is
        further limited by any scopes or permissions granted to the token. A
        token cannot grant additional access capabilities to a user. For
        example, a personal access token can be configured with an admin:org
        scope, but if the owner of the token is not an organization owner, the
        token will not give administrative access to the organization.

      references:
        - 'https://github.blog/engineering/platform-security/behind-githubs-new-authentication-token-formats/'
        - 'https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens'

    target:
      prefix_pattern: >-
        \A|\W

      pattern: >-
        ghp_[0-9A-Za-z]{36}

      suffix_pattern: >-
        \W|\z

    analyzers:
      - *github_user_analyzer

    filters:
      - kind: require
        target_min_entropy: 2

  - id: S3IGA2DTZOHC3DRBHIJQ
    meta:
      kind: github_fine_grained_personal_access_token
      name: 'GitHub Fine-Grained Personal Access Token'
      confidence: high
      report: true
      tags: ['secret', 'credential']
      description:
        Personal access tokens are an alternative to using passwords for
        authentication to GitHub when using the GitHub API or the command line.

        Personal access tokens are intended to access GitHub resources on
        behalf of yourself. To access resources on behalf of an organization,
        or for long-lived integrations, you should use a GitHub App. For more
        information, see About creating GitHub Apps.

        A token has the same capabilities to access resources and perform
        actions on those resources that the owner of the token has, and is
        further limited by any scopes or permissions granted to the token. A
        token cannot grant additional access capabilities to a user. For
        example, a personal access token can be configured with an admin:org
        scope, but if the owner of the token is not an organization owner, the
        token will not give administrative access to the organization.

      references:
        - https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens

    target:
      prefix_pattern: >-
        \A|\W

      pattern: >-
        github_pat_\w{82}

      suffix_pattern: >-
        \W|\z

    filters:
      - kind: require
        target_min_entropy: 2

    analyzers:
      - *github_user_analyzer
